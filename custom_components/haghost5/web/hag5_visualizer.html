<!DOCTYPE html>
<html lang="en">
<head>
  <title>three.js webgl - loaders - GCode loader</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

  </style>
</head>

<body>

  <!-- Carichiamo Three.js e i loader via un CDN "unpkg". 
       In futuro potrai servire questi file localmente se preferisci. -->
  <script type="module">

    import * as THREE from 'https://unpkg.com/three@0.153.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.153.0/examples/jsm/controls/OrbitControls.js';
    import { GCodeLoader } from 'https://unpkg.com/three@0.153.0/examples/jsm/loaders/GCodeLoader.js';

    let camera, scene, renderer, controls;

    init();
    animate();

    function init() {

      // Impostiamo la camera
      camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
      camera.position.set( 0, 0, 70 );

      // Creiamo la scena
      scene = new THREE.Scene();

      // Aggiungiamo un'illuminazione minimale (non indispensabile, ma utile se in futuro aggiungi oggetti)
      const light = new THREE.AmbientLight( 0xffffff, 1 );
      scene.add( light );

      // Esempio: carichiamo un file GCODE fisso (benchy.gcode)
      // In seguito, potrai sostituire 'benchy.gcode' con un URL 
      // che punta al file .gcode caricato su Home Assistant (es. /local/gcodes/...)
      const loader = new GCodeLoader();
      loader.load( 'benchy.gcode', function ( object ) {

        object.position.set( -100, -20, 0 );   // spostiamo l'oggetto un po' al centro
        scene.add( object );

        console.log('GCODE loaded and added to scene', object);

      }, undefined, function ( error ) {
        console.error( 'Error loading GCODE:', error );
      } );

      // Creiamo il renderer
      renderer = new THREE.WebGLRenderer( { antialias: true } );
      renderer.setPixelRatio( window.devicePixelRatio );
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

      // Controlli orbitali per muovere la camera
      controls = new OrbitControls( camera, renderer.domElement );
      controls.minDistance = 10;
      controls.maxDistance = 200;

      // Eventi di resize
      window.addEventListener( 'resize', onWindowResize );

    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize( window.innerWidth, window.innerHeight );
    }

    function animate() {
      requestAnimationFrame( animate );
      controls.update(); // se non usi animazioni potresti renderizzare solo al bisogno
      renderer.render( scene, camera );
    }

  </script>

</body>
</html>
